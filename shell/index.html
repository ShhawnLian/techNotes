
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="技术博客">
      
      
      
        <meta name="author" content="weiya">
      
      
        <link rel="canonical" href="https://tech.hohoweiya.xyz/shell/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.5">
    
    
      
        <title>Shell - techNotes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    

  
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-85007363-6","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
  <script data-ad-client="ca-pub-3680148472128768" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shell" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="techNotes" class="md-header__button md-logo" aria-label="techNotes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            techNotes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Shell
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/szcf-weiya/techNotes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    szcf-weiya/techNotes
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="techNotes" class="md-nav__button md-logo" aria-label="techNotes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    techNotes
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/szcf-weiya/techNotes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    szcf-weiya/techNotes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Linux
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/" class="md-nav__link">
        系统
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/software/" class="md-nav__link">
        大软件
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/tools/" class="md-nav__link">
        小工具
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/servers/" class="md-nav__link">
        服务器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/16to18/" class="md-nav__link">
        16to18
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/asAserver/" class="md-nav__link">
        笔记本作为服务器
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Shell
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Shell
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#shell_1" class="md-nav__link">
    shell变量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iterators-in-for-loop" class="md-nav__link">
    iterators in for loop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    String
  </a>
  
    <nav class="md-nav" aria-label="String">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strip-first-2-characters" class="md-nav__link">
    strip first 2 characters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strip-from-left-or-right" class="md-nav__link">
    strip from left or right
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-last-character" class="md-nav__link">
    remove last character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-character" class="md-nav__link">
    replace character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-value" class="md-nav__link">
    default value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell_2" class="md-nav__link">
    shell数组
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sed" class="md-nav__link">
    sed
  </a>
  
    <nav class="md-nav" aria-label="sed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-r" class="md-nav__link">
    -r: 扩展的正则表达式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    实战一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    实战二
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    批量重命名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    统计访问日志里每个 ip 访问次数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#split-string-while-reading-files" class="md-nav__link">
    split string while reading files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribute-jobs-into-queues" class="md-nav__link">
    distribute jobs into queues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command line arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-elements-of-an-array-in-bash" class="md-nav__link">
    join elements of an array in Bash
  </a>
  
    <nav class="md-nav" aria-label="join elements of an array in Bash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-more-complex-way" class="md-nav__link">
    A more complex way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp" class="md-nav__link">
    timestamp
  </a>
  
    <nav class="md-nav" aria-label="timestamp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compare-two-timestamps" class="md-nav__link">
    compare two timestamps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#globbing-for-ls-vs-regular-expression-for-find" class="md-nav__link">
    globbing for ls vs regular expression for find
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-the-first-field" class="md-nav__link">
    select the first field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-ifs" class="md-nav__link">
    Multiple IFS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    链接自动推送
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#only-show-directory" class="md-nav__link">
    Only show directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-whether-a-certain-file-typeextension-exists-in-directory" class="md-nav__link">
    Check whether a certain file type/extension exists in directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-path-of-the-current-script" class="md-nav__link">
    Get path of the current script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-statement" class="md-nav__link">
    if statement
  </a>
  
    <nav class="md-nav" aria-label="if statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logical-operation" class="md-nav__link">
    logical operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-string" class="md-nav__link">
    test string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-file" class="md-nav__link">
    test file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aka-test-vs" class="md-nav__link">
    [ (aka test) vs [[
  </a>
  
    <nav class="md-nav" aria-label="[ (aka test) vs [[">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    $[
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vs-vs-eq" class="md-nav__link">
    = vs == vs -eq
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-string" class="md-nav__link">
    compare string
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grep-keep-the-first-line-use-sed-instead" class="md-nav__link">
    grep keep the first line (use sed instead)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-two-blocks-in-a-txt-file" class="md-nav__link">
    compare two blocks in a txt file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    ||
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replace-a-multiple-line-string" class="md-nav__link">
    Replace a multiple line string
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        StatProgramming
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="StatProgramming" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          StatProgramming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        R
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="R" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          R
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/" class="md-nav__link">
        一般问题
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/basic/" class="md-nav__link">
        统计基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/plot/" class="md-nav__link">
        plot 作图
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/ggplot/" class="md-nav__link">
        ggplot 作图
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/legend_from_zhihu/" class="md-nav__link">
        案例分析
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/install-notes-for-rmysql/" class="md-nav__link">
        源码安装 RMySQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/sample/" class="md-nav__link">
        new sample function (v3.6.0+)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../R/factor/" class="md-nav__link">
        一道与 factor 有关的问题
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Python
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        一般问题
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/conda/" class="md-nav__link">
        Conda
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/pystan/" class="md-nav__link">
        PyStan 体验
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/opencv/" class="md-nav__link">
        OpenCV
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/finance/" class="md-nav__link">
        金融数据爬虫
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/rpy2/" class="md-nav__link">
        rpy2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../python/esltag/" class="md-nav__link">
        自建关键词索引页
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../julia/" class="md-nav__link">
        Julia
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Matlab/" class="md-nav__link">
        Matlab
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comparisons/stat/" class="md-nav__link">
        Comparisons
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        CSProgramming
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="CSProgramming" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CSProgramming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Cpp/" class="md-nav__link">
        C/C++
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../java/" class="md-nav__link">
        Java
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../SQL/" class="md-nav__link">
        SQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cuda/" class="md-nav__link">
        Cuda
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        DocProgramming
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DocProgramming" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          DocProgramming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      <label class="md-nav__link" for="__nav_5_1">
        TeX
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="TeX" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          TeX
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/" class="md-nav__link">
        一般问题
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/arxiv/" class="md-nav__link">
        arXiv
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/vargreek/" class="md-nav__link">
        VarGreek
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      <label class="md-nav__link" for="__nav_5_2">
        Web
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Web" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../website/" class="md-nav__link">
        Website
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../website/disqus/" class="md-nav__link">
        Disqus
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../website/css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../js/" class="md-nav__link">
        JS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../PHP/" class="md-nav__link">
        PHP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../website/xampp/" class="md-nav__link">
        XAMPP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Network
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Network" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/" class="md-nav__link">
        一般问题
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/sci-int/" class="md-nav__link">
        访问内网
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/ipv6/" class="md-nav__link">
        IPv6
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Development
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../autotools/" class="md-nav__link">
        Autotools
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Git/" class="md-nav__link">
        Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../phantomjs/" class="md-nav__link">
        Phantomjs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Qt/" class="md-nav__link">
        Qt
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Stat
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Stat" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Stat
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../stats/prob/" class="md-nav__link">
        Probability
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../stats/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scientific/" class="md-nav__link">
        Scientific
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../stats/matrix/" class="md-nav__link">
        Matrix
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../English/" class="md-nav__link">
        English
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../finance/" class="md-nav__link">
        Finance
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../guitar/" class="md-nav__link">
        Guitar
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../win/" class="md-nav__link">
        Windows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fresh/" class="md-nav__link">
        Fresh
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../links/" class="md-nav__link">
        Links
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      <label class="md-nav__link" for="__nav_15">
        Misc
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Misc" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../misc/wx/" class="md-nav__link">
        小程序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../misc/wxjssdk/" class="md-nav__link">
        jssdk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../misc/report/" class="md-nav__link">
        讲座
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mi/" class="md-nav__link">
        Mi
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#shell_1" class="md-nav__link">
    shell变量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iterators-in-for-loop" class="md-nav__link">
    iterators in for loop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    String
  </a>
  
    <nav class="md-nav" aria-label="String">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strip-first-2-characters" class="md-nav__link">
    strip first 2 characters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strip-from-left-or-right" class="md-nav__link">
    strip from left or right
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-last-character" class="md-nav__link">
    remove last character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-character" class="md-nav__link">
    replace character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-value" class="md-nav__link">
    default value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell_2" class="md-nav__link">
    shell数组
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sed" class="md-nav__link">
    sed
  </a>
  
    <nav class="md-nav" aria-label="sed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-r" class="md-nav__link">
    -r: 扩展的正则表达式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    实战一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    实战二
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    批量重命名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    统计访问日志里每个 ip 访问次数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#split-string-while-reading-files" class="md-nav__link">
    split string while reading files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribute-jobs-into-queues" class="md-nav__link">
    distribute jobs into queues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command line arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-elements-of-an-array-in-bash" class="md-nav__link">
    join elements of an array in Bash
  </a>
  
    <nav class="md-nav" aria-label="join elements of an array in Bash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-more-complex-way" class="md-nav__link">
    A more complex way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp" class="md-nav__link">
    timestamp
  </a>
  
    <nav class="md-nav" aria-label="timestamp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compare-two-timestamps" class="md-nav__link">
    compare two timestamps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#globbing-for-ls-vs-regular-expression-for-find" class="md-nav__link">
    globbing for ls vs regular expression for find
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-the-first-field" class="md-nav__link">
    select the first field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-ifs" class="md-nav__link">
    Multiple IFS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    链接自动推送
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#only-show-directory" class="md-nav__link">
    Only show directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-whether-a-certain-file-typeextension-exists-in-directory" class="md-nav__link">
    Check whether a certain file type/extension exists in directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-path-of-the-current-script" class="md-nav__link">
    Get path of the current script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-statement" class="md-nav__link">
    if statement
  </a>
  
    <nav class="md-nav" aria-label="if statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logical-operation" class="md-nav__link">
    logical operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-string" class="md-nav__link">
    test string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-file" class="md-nav__link">
    test file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aka-test-vs" class="md-nav__link">
    [ (aka test) vs [[
  </a>
  
    <nav class="md-nav" aria-label="[ (aka test) vs [[">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    $[
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vs-vs-eq" class="md-nav__link">
    = vs == vs -eq
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-string" class="md-nav__link">
    compare string
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grep-keep-the-first-line-use-sed-instead" class="md-nav__link">
    grep keep the first line (use sed instead)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-two-blocks-in-a-txt-file" class="md-nav__link">
    compare two blocks in a txt file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    ||
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replace-a-multiple-line-string" class="md-nav__link">
    Replace a multiple line string
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="shell">shell相关<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h1>
<p>教程参考</p>
<ol>
<li><a href="http://www.runoob.com/linux/linux-shell.html">菜鸟教程</a></li>
</ol>
<h2 id="shell_1">shell变量<a class="headerlink" href="#shell_1" title="Permanent link">&para;</a></h2>
<ol>
<li>定义变量时，变量名不加美元符号</li>
<li>变量名和等号之间不能有空格</li>
<li>变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，比如下面 <code>for</code> 循环中举的 <code>${skill}</code> 例子。</li>
</ol>
<h2 id="iterators-in-for-loop">iterators in <code>for</code> loop<a class="headerlink" href="#iterators-in-for-loop" title="Permanent link">&para;</a></h2>
<ul>
<li>separated by space</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span> skill <span class="k">in</span> Ada Coffe Action Java<span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">&quot;I am good at </span><span class="si">${</span><span class="nv">skill</span><span class="si">}</span><span class="s2">Script&quot;</span>
<span class="k">done</span>
</code></pre></div>
<ul>
<li><code>start..stop..length</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span> i <span class="k">in</span> <span class="o">{</span><span class="m">5</span>..50..5<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not valid in <code>sh</code>, and use it with <code>bash</code>!
<div class="highlight"><pre><span></span><code>$ ./sumbit_job.sh
<span class="m">2</span>
<span class="m">4</span>
<span class="m">6</span>
<span class="m">8</span>
$ sh ./sumbit_job.sh
<span class="o">{</span><span class="m">2</span>..8..2<span class="o">}</span>
</code></pre></div></p>
</div>
<ul>
<li>construct an array</li>
</ul>
<p>actually, it can be used to construct an array,</p>
<div class="highlight"><pre><span></span><code><span class="nv">arr</span><span class="o">=({</span><span class="m">1</span>..10..2<span class="o">})</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span>
<span class="k">for</span> i <span class="k">in</span> <span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>
<ul>
<li><code>seq</code></li>
</ul>
<p>alternatively, we can use <code>seq</code>,</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> i <span class="k">in</span> <span class="k">$(</span>seq <span class="m">5</span> <span class="m">5</span> <span class="m">50</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>
<h2 id="string">String<a class="headerlink" href="#string" title="Permanent link">&para;</a></h2>
<ol>
<li>单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；</li>
<li>单引号字串中不能出现单引号（对单引号使用转义符后也不行）。</li>
<li>双引号里可以有变量</li>
<li>双引号里可以出现转义字符</li>
</ol>
<h3 id="strip-first-2-characters">strip first 2 characters<a class="headerlink" href="#strip-first-2-characters" title="Permanent link">&para;</a></h3>
<p>simplest way:</p>
<div class="highlight"><pre><span></span><code><span class="si">${</span><span class="nv">string</span><span class="p">:</span><span class="nv">2</span><span class="si">}</span>
</code></pre></div>
<p>some alternatives refer to <a href="https://stackoverflow.com/questions/11469989/how-can-i-strip-first-x-characters-from-string-using-sed">How can I strip first X characters from string using sed?</a>, or <a href="https://stackoverflow.com/questions/6594085/remove-first-character-of-a-string-in-bash">Remove first character of a string in Bash</a></p>
<p>a real application in my project:</p>
<div class="highlight"><pre><span></span><code><span class="nv">list</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">for</span> nc <span class="k">in</span> <span class="o">{</span><span class="m">2</span>..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
  <span class="k">for</span> nf <span class="k">in</span> <span class="m">5</span> <span class="m">10</span> <span class="m">15</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">list</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$list</span><span class="s2">,acc-</span><span class="nv">$nc</span><span class="s2">-</span><span class="nv">$nf</span><span class="s2">&quot;</span>
    <span class="c1">#https://stackoverflow.com/questions/6594085/remove-first-character-of-a-string-in-bash</span>
    <span class="nb">echo</span> <span class="si">${</span><span class="nv">list</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
  <span class="k">done</span>
<span class="k">done</span>
</code></pre></div>
<h3 id="strip-from-left-or-right">strip from left or right<a class="headerlink" href="#strip-from-left-or-right" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 从左最大化匹配字符 `y`，然后截掉左边内容</span>
$ <span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">##*y</span><span class="si">}</span>
zz
<span class="c1"># 从左匹配第一个字符 `y`</span>
$ <span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">#*y</span><span class="si">}</span>
yzz
<span class="c1"># 从右最大化匹配字符 `y`，然后截掉右边内容</span>
$ <span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">%%y*</span><span class="si">}</span>
xx
<span class="c1"># 从右匹配第一个字符 `y`</span>
$ <span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">%y*</span><span class="si">}</span>
xxy
</code></pre></div>
<h3 id="remove-last-character">remove last character<a class="headerlink" href="#remove-last-character" title="Permanent link">&para;</a></h3>
<p>with <code>bash 4.2+</code>,</p>
<div class="highlight"><pre><span></span><code>$ <span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">:</span><span class="k">:-</span><span class="nv">1</span><span class="si">}</span>
xxyyz
</code></pre></div>
<p>refer to <a href="https://unix.stackexchange.com/questions/144298/delete-the-last-character-of-a-string-using-string-manipulation-in-shell-script">Delete the last character of a string using string manipulation in shell script</a></p>
<h3 id="replace-character">replace character<a class="headerlink" href="#replace-character" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>$ <span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">/xx/XX</span><span class="si">}</span>
XXyyzz
</code></pre></div>
<h3 id="default-value">default value<a class="headerlink" href="#default-value" title="Permanent link">&para;</a></h3>
<ul>
<li><code>${1:-foo}</code>: if parameter is unset or <strong>null</strong>, the expansion of word is substituted.</li>
<li><code>${1-foo}</code>: only substitute if parameter is unset.</li>
</ul>
<p>refer to <a href="https://stackoverflow.com/questions/9332802/how-to-write-a-bash-script-that-takes-optional-input-arguments">How to write a bash script that takes optional input arguments?</a></p>
<p>applications:</p>
<ul>
<li><a href="https://github.com/szcf-weiya/Clouds/blob/b8abfc63078ac53e817c2a3d7f3e92d44cf47f61/run_test_local.sh#L5-L9">Clouds/run_test_local.sh</a></li>
</ul>
<h2 id="shell_2">shell数组<a class="headerlink" href="#shell_2" title="Permanent link">&para;</a></h2>
<ol>
<li>在Shell中，用括号来表示数组，数组元素用“空格”符号分割开。</li>
</ol>
<h2 id="sed">sed<a class="headerlink" href="#sed" title="Permanent link">&para;</a></h2>
<p>参考</p>
<ol>
<li><a href="http://man.linuxde.net/sed">sed命令_Linux sed 命令用法详解：功能强大的流式文本编辑器</a></li>
<li><a href="https://www.cnblogs.com/nhlinkin/p/3647357.html">sed &amp; awk常用正则表达式 - 菲一打 - 博客园</a></li>
</ol>
<ul>
<li>打印特定行，比如第 10 行：<code>sed '10!d' file.txt</code>, 参考 <a href="https://stackoverflow.com/questions/19327556/get-specific-line-from-text-file-using-just-shell-script">Get specific line from text file using just shell script</a></li>
<li>打印行范围，<code>sed -n '10,20p' file.txt</code>，则单独打印第 10 行也可以由 <code>sed -n '10p' file.txt</code> 给出，如果采用分号 <code>;</code> 则不是连续选择，而只是特定的行，参考 <a href="https://blog.csdn.net/raysen_zj/article/details/46761253">sed之打印特定行与连续行</a><ul>
<li>第一行到最后一行：<code>sed -n '1,$p'</code></li>
<li>第一行和最后一行：<code>sed -n '1p;$p'</code>, not <del><code>sed -n '1;$p'</code></del></li>
</ul>
</li>
<li>删除最后一行：<code>sed -i '$ d' file.txt</code></li>
<li>在 vi 中注释多行：按住 v 选定特定行之后，按住 <code>:s/^/#/g</code> 即可添加注释，取消注释则用 <code>:s/^#//g</code>. 另见 VI.</li>
</ul>
<!-- ## `|`的作用

> 竖线(|)元字符是元字符扩展集的一部分，用于指定正则表达式的联合。如果某行匹配其中的一个正则表达式，那么它就匹配该模式。 -->

<h3 id="-r"><code>-r</code>: 扩展的正则表达式<a class="headerlink" href="#-r" title="Permanent link">&para;</a></h3>
<p>参考<a href="https://www.gnu.org/software/sed/manual/html_node/Extended-regexps.html">Extended regexps - sed, a stream editor</a></p>
<p>摘录如下</p>
<blockquote>
<p>The only difference between basic and extended regular expressions is in the behavior of a few characters: ‘?’, ‘+’, parentheses, and braces (‘{}’). While basic regular expressions require these to be escaped if you want them to behave as special characters, when using extended regular expressions you must escape them if you want them to match a literal character.</p>
</blockquote>
<p>就是说 basic 模式下，要使用特殊字符（如正则表达式中）需要转义，但 extended 模式相反，转义后表达的是原字符。</p>
<p>举个例子</p>
<ol>
<li><code>abc?</code> becomes <code>abc\?</code> when using extended regular expressions. It matches the literal string ‘abc?’.</li>
<li><code>c\+</code> becomes <code>c+</code> when using extended regular expressions. It matches one or more ‘c’s.</li>
<li><code>a\{3,\}</code> becomes <code>a{3,}</code> when using extended regular expressions. It matches three or more ‘a’s.</li>
<li><code>\(abc\)\{2,3\}</code> becomes <code>(abc){2,3}</code> when using extended regular expressions. It matches either <code>abcabc</code> or <code>abcabcabc</code>.</li>
<li><code>\(abc*\)\1</code> becomes <code>(abc*)\1</code> when using extended regular expressions. Backreferences must still be escaped when using extended regular expressions.</li>
</ol>
<h3 id="_1">实战一<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>将</p>
<div class="highlight"><pre><span></span><code>![IMG_0802](https://user-images.githubusercontent.com/13688320/72489850-733ae480-3850-11ea-8e51-15021588a7e6.jpg)
</code></pre></div>
<p>替换成</p>
<div class="highlight"><pre><span></span><code>[IMG_0802]: https://user-images.githubusercontent.com/13688320/72489850-733ae480-3850-11ea-8e51-15021588a7e6.jpg
</code></pre></div>
<p>解决方案</p>
<div class="highlight"><pre><span></span><code>sed -i <span class="s2">&quot;s/\!\[IMG_\([0-9]\{4\}\)\](\(.*\))/\[IMG_\1\]\: \2/g&quot;</span> FILENAME
</code></pre></div>
<ul>
<li><code>\(\)</code> 用于匹配子串，并可以通过 <code>\1</code>, <code>\2</code> 引用</li>
<li><code>\!</code> 需要 escape</li>
<li><code>\2</code> 前面的空格不需要写成 <code>[ ]</code>，不然会直接出现 <code>[ ]</code>，而之前某次为了匹配多个空格需要写成 <code>[ ]*</code></li>
</ul>
<p>人总是善变的，过了一段时间，我又想把这些 img 下载到本地文件夹，但是之前处理过的文件都删掉了，只剩下传到 github 上的了，所以我首先要把文件下载到合适的位置并重命名。比如对于文件 <code>_posts/2019-12-21-quant-genetics.md</code>，只保留了 <code>https://user-images.githubusercontent.com/</code> 的链接，采用下面的脚本下载到合适的位置并重命名，</p>
<div class="highlight"><pre><span></span><code>grep -E <span class="s2">&quot;https://user-images.&quot;</span> _posts/2019-12-21-quant-genetics.md <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> -a ADDR<span class="p">;</span> <span class="k">do</span> <span class="k">if</span> <span class="o">[</span> <span class="si">${#</span><span class="nv">ADDR</span><span class="p">[@]</span><span class="si">}</span> -eq <span class="m">2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> proxychains wget <span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span> -O images/2019-12-21-quant-genetics/<span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]:</span><span class="nv">1</span><span class="p">:</span><span class="nv">8</span><span class="si">}</span>.jpg<span class="p">;</span> <span class="k">fi</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div>
<p>其中</p>
<ul>
<li><code>ADDR[0]:1:8</code> 是所谓的 <a href="https://unix.stackexchange.com/questions/9468/how-to-get-the-char-at-a-given-position-of-a-string-in-shell-script">&ldquo;Parameter Expansion&rdquo; ${parameter:offset:length}</a>，用于提取特定范围的子串</li>
<li><code>wget -O</code> 是重命名，这里顺带移动到合适的位置</li>
<li><code>proxychains</code> 则是用于科学上网</li>
<li><code>read -a ADDR</code> 表示将分割后的字符串（比如默认按照空格进行分割，或者指定 <code>IFS=</code>）放进数组 ADDR 中，详见 <code>help read</code>，而 <code>man read</code> 并没有给出参数列表。另外需要注意到数组 <code>$ADDR</code> 返回结果为 <code>${ADDR[0]}</code>.</li>
</ul>
<h3 id="_2">实战二<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>将 ESL-CN 中的手动输入的时间统一为发布的时间，详见<a href="https://github.com/szcf-weiya/ESL-CN/commit/431c8defa535b4448b8256a9639d5a633d00622d"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M17.5 11.75a.75.75 0 0 1 .75-.75h5a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1-.75-.75zm-17.5 0A.75.75 0 0 1 .75 11h5a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1-.75-.75z"/><path fill-rule="evenodd" d="M12 16.25a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9zm0 1.5a6 6 0 1 0 0-12 6 6 0 0 0 0 12z"/></svg></span></a></p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> file <span class="k">in</span> <span class="k">$(</span>find . -regex <span class="s2">&quot;./.*\.md&quot;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">first</span><span class="o">=</span><span class="k">$(</span>git log --date<span class="o">=</span>short --format<span class="o">=</span>%ad --follow <span class="nv">$file</span> <span class="p">|</span> tail -1<span class="k">)</span>
    <span class="nb">echo</span> <span class="nv">$file</span> <span class="nv">$first</span>
    sed -i <span class="s2">&quot;s/^\(|*\)[ ]*时间[ ]*|[^|]*\(|*\)[ ]*</span>$<span class="s2">/\1 发布 | </span><span class="nv">$first</span><span class="s2"> \2/g&quot;</span> <span class="nv">$file</span>
<span class="k">done</span>
</code></pre></div>
<p>其中 </p>
<ul>
<li><code>$first</code> 提取最初 commit 的时间</li>
<li><code>\1</code> 和 <code>\2</code> 是为了处理有些表格写的是 <code>|--|--|</code>，而有些用的是 <code>--|--</code>，如果混用，则列会发生偏移，所以自适应保留原先的格式</li>
<li><code>|[^|]*</code> 是为了匹配第二个除表格符号 <code>|</code> 的内容，不要直接用 <code>|.*</code>，这样也会匹配最后的 <code>|</code>，从而 <code>\2</code> 匹配不到</li>
<li>定界符<code>^$</code> 为了防止匹配正文中的 <code>时间</code></li>
</ul>
<h2 id="_3">批量重命名<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>有时候下载文件时网站并没有区分同名文件，下载到本地后会出现 <code>A.zip</code> 与 <code>A (1).zip</code> 的情况，但这两个并不是相同的文件，所以避免以后误删，决定重命名。不过此类文件有好几个，批量处理代码为</p>
<div class="highlight"><pre><span></span><code>$ ls -1 <span class="p">|</span> grep <span class="s2">&quot;(1)&quot;</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> -a ADDR<span class="p">;</span> <span class="k">do</span> mv <span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2"> (1).zip&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2">_SOMETHING.zip&quot;</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div>
<h2 id="ip">统计访问日志里每个 ip 访问次数<a class="headerlink" href="#ip" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
cat access.log <span class="p">|</span>sed -rn <span class="s1">&#39;/28\/Jan\/2015/p&#39;</span> &gt; a.txt
cat a.txt <span class="p">|</span>awk <span class="s1">&#39;{print $1}&#39;</span><span class="p">|</span>sort <span class="p">|</span>uniq &gt; ipnum.txt
<span class="k">for</span> i <span class="k">in</span> <span class="sb">`</span>cat ipnum.txt<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">iptj</span><span class="o">=</span><span class="sb">`</span>cat  access.log <span class="p">|</span>grep <span class="nv">$i</span> <span class="p">|</span> grep -v <span class="m">400</span> <span class="p">|</span>wc -l<span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">&quot;ip地址&quot;</span><span class="nv">$i</span><span class="s2">&quot;在2015-01-28日全天(24小时)累计成功请求&quot;</span><span class="nv">$iptj</span><span class="s2">&quot;次，平均每分钟请求次数为：&quot;</span><span class="k">$((</span><span class="nv">$iptj</span><span class="o">/</span><span class="m">1440</span><span class="k">))</span> &gt;&gt; result.txt
<span class="k">done</span>
</code></pre></div>
<p>其中 <code>awk</code> 标准用法为</p>
<div class="highlight"><pre><span></span><code>awk <span class="s1">&#39;/pattern/ {print &quot;$1&quot;}&#39;</span>
</code></pre></div>
<p><code>/pattern/</code> 可以是正则表达式，也可以是两个特殊的pattern，</p>
<ul>
<li><code>BEGIN</code>: execute the action(s) before any input lines are read</li>
<li><code>END</code>: execute the action(s) before it actually exits</li>
</ul>
<p>默认分隔符为空格，或者通过 <code>-F</code> 指定其它的分隔符，</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> <span class="s1">&#39;a b&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span>
b
$ <span class="nb">echo</span> <span class="s1">&#39;a,b&#39;</span> <span class="p">|</span> awk -F, <span class="s1">&#39;{print $2}&#39;</span>
b
</code></pre></div>
<p>另外上述脚本中用到了 <code>awk</code> 支持跨行状态的特性，即</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> -e <span class="s1">&#39;a b \n c d&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span>
b
d
</code></pre></div>
<p>其中 <code>-e</code> 是为了 escape 换行符，最后一列也可以用 <code>$NF</code> 表示，</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> -e <span class="s1">&#39;a b \n c d&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $NF}&#39;</span>
b
d
</code></pre></div>
<p>如果想要得到列数，则使用 <code>NF</code>,</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> -e <span class="s1">&#39;a b \n c d&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print NF}&#39;</span>
<span class="m">2</span>
<span class="m">2</span>
</code></pre></div>
<p>如果默认每行列数相等，只想得到列数的话，可以使用</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> -e <span class="s1">&#39;a b \n c d&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print NF; exit}&#39;</span>
<span class="m">2</span>
</code></pre></div>
<p>如果数据文件为 <code>file.txt</code>，则可以直接用</p>
<div class="highlight"><pre><span></span><code>awk <span class="s1">&#39;{print NF; exit}&#39;</span> file.txt
</code></pre></div>
<p>Refer to</p>
<ul>
<li><a href="https://www.cnblogs.com/paul8339/p/6207182.html">用shell统计访问日志里每个ip访问次数</a></li>
<li><a href="https://linux.cn/article-3945-1.html">技术|如何在Linux中使用awk命令</a></li>
<li><a href="https://stackoverflow.com/questions/8629330/unix-count-of-columns-in-file">unix - count of columns in file</a></li>
<li><a href="http://www.pement.org/awk/awk1line.txt">HANDY ONE-LINE SCRIPTS FOR AWK</a></li>
<li><a href="https://www.tecmint.com/learn-use-awk-special-patterns-begin-and-end/">Learn How to Use Awk Special Patterns ‘BEGIN and END’ – Part 9</a></li>
</ul>
<h2 id="split-string-while-reading-files">split string while reading files<a class="headerlink" href="#split-string-while-reading-files" title="Permanent link">&para;</a></h2>
<p>specify <code>IFS=</code>.</p>
<ol>
<li><a href="https://stackoverflow.com/questions/19719827/how-to-split-a-tab-delimited-string-in-bash-script-without-collapsing-blanks">How to split a tab-delimited string in bash script WITHOUT collapsing blanks?</a></li>
<li><a href="https://stackoverflow.com/questions/27500692/split-string-in-shell-script-while-reading-from-file">Split String in shell script while reading from file</a></li>
<li><a href="https://stackoverflow.com/questions/10929453/read-a-file-line-by-line-assigning-the-value-to-a-variable">Read a file line by line assigning the value to a variable</a></li>
</ol>
<h2 id="distribute-jobs-into-queues">distribute jobs into queues<a class="headerlink" href="#distribute-jobs-into-queues" title="Permanent link">&para;</a></h2>
<p>since different queues has different quota, try to assign the job into available nodes.</p>
<div class="highlight"><pre><span></span><code><span class="nv">queue</span><span class="o">=(</span>bigmem large batch<span class="o">)</span>
<span class="nv">queues</span><span class="o">=()</span>
<span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;<span class="m">12</span><span class="p">;</span>i++<span class="o">))</span> <span class="k">do</span> <span class="nv">queues</span><span class="o">+=(</span><span class="si">${</span><span class="nv">queue</span><span class="p">[0]</span><span class="si">}</span><span class="o">)</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>
<span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;<span class="m">20</span><span class="p">;</span>i++<span class="o">))</span> <span class="k">do</span> <span class="nv">queues</span><span class="o">+=(</span><span class="si">${</span><span class="nv">queue</span><span class="p">[1]</span><span class="si">}</span><span class="o">)</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>
<span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;<span class="m">15</span><span class="p">;</span>i++<span class="o">))</span> <span class="k">do</span> <span class="nv">queues</span><span class="o">+=(</span><span class="si">${</span><span class="nv">queue</span><span class="p">[2]</span><span class="si">}</span><span class="o">)</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>
</code></pre></div>
<p>where <code>((i++))</code> increases <code>i</code> by 1, and similar syntax can be</p>
<div class="highlight"><pre><span></span><code><span class="nv">i</span><span class="o">=</span><span class="m">0</span>
<span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span>
<span class="c1"># or</span>
<span class="nv">i</span><span class="o">=</span><span class="k">$((</span><span class="nv">$i</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="c1"># or</span>
<span class="o">((</span><span class="nv">i</span><span class="o">+=</span><span class="m">1</span><span class="o">))</span>
<span class="c1"># or</span>
<span class="o">((</span>i++<span class="o">))</span>
</code></pre></div>
<p><code>((...))</code> also support general arithmetic operations, such as</p>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="o">=</span><span class="m">30</span>
<span class="nv">b</span><span class="o">=</span><span class="m">10</span>
<span class="nb">echo</span> <span class="k">$((</span><span class="nv">a</span><span class="o">+=</span>b<span class="k">))</span>
<span class="nb">echo</span> <span class="k">$((</span>a*<span class="o">=</span>b<span class="k">))</span>
<span class="nb">echo</span> <span class="k">$((</span>a-<span class="o">=</span>b<span class="k">))</span>
<span class="nb">echo</span> <span class="k">$((</span>a/<span class="o">=</span>b<span class="k">))</span>
<span class="nb">echo</span> <span class="k">$((</span>a/<span class="o">=</span>b<span class="k">))</span>
<span class="c1"># 40</span>
<span class="c1"># 400</span>
<span class="c1"># 390</span>
<span class="c1"># 39</span>
<span class="c1"># 3</span>
</code></pre></div>
<p>but note that it does not allow float number, as the last equation, which should be <code>39/10=3.9</code></p>
<p>the float calculation can take the advantage of other programs, such as</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Note that `BEGIN` cannot be removed, otherwise it is waiting for input file</span>
<span class="c1"># see the BEGIN and END pattern of awk</span>
$ awk <span class="s2">&quot;BEGIN {print 39/10}&quot;</span>
<span class="m">3</span>.9
$ bc <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;39/10&quot;</span>
<span class="m">3</span>
$ bc <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;scale=2; 39/10&quot;</span>
<span class="m">3</span>.90
</code></pre></div>
<p>refer to</p>
<ul>
<li><a href="https://stackoverflow.com/questions/1951506/add-a-new-element-to-an-array-without-specifying-the-index-in-bash">Add a new element to an array without specifying the index in Bash</a></li>
<li><a href="https://stackoverflow.com/questions/29205213/repeat-an-element-n-number-of-times-in-an-array">Repeat an element n number of times in an array</a></li>
<li><a href="http://tldp.org/LDP/abs/html/dblparens.html">The Double-Parentheses Construct</a></li>
<li><a href="https://stackoverflow.com/questions/21035121/increment-variable-value-by-1-shell-programming">Increment variable value by 1 ( shell programming)</a></li>
<li><a href="http://www.runoob.com/linux/linux-shell-array.html">Shell 数组</a></li>
<li><a href="https://unix.stackexchange.com/questions/40786/how-to-do-integer-float-calculations-in-bash-or-other-languages-frameworks">How to do integer &amp; float calculations, in bash or other languages/frameworks?</a></li>
</ul>
<h2 id="command-line-arguments">Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permanent link">&para;</a></h2>
<p>refer to <a href="https://www.devdungeon.com/content/taking-command-line-arguments-bash">Taking Command Line Arguments in Bash</a></p>
<h2 id="join-elements-of-an-array-in-bash">join elements of an array in Bash<a class="headerlink" href="#join-elements-of-an-array-in-bash" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nv">arr</span><span class="o">=(</span>a b c<span class="o">)</span>
<span class="nb">printf</span> <span class="s1">&#39;%s\n&#39;</span> <span class="s2">&quot;</span><span class="k">$(</span><span class="nv">IFS</span><span class="o">=</span>,<span class="p">;</span> <span class="nb">printf</span> <span class="s1">&#39;%s&#39;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">arr</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="c1"># a,b,c</span>
</code></pre></div>
<p>where <code>*</code> or <code>@</code> return all elements of such array.</p>
<p>refer to <a href="https://stackoverflow.com/questions/1527049/how-can-i-join-elements-of-an-array-in-bash">How can I join elements of an array in Bash?</a></p>
<h3 id="a-more-complex-way">A more complex way<a class="headerlink" href="#a-more-complex-way" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">list</span><span class="o">=</span>
<span class="k">for</span> nc <span class="k">in</span> <span class="o">{</span><span class="m">2</span>..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
  <span class="k">for</span> nf <span class="k">in</span> <span class="m">5</span> <span class="m">10</span> <span class="m">15</span><span class="p">;</span> <span class="k">do</span>
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$list</span><span class="s2">&quot;</span> <span class="o">]</span>
    <span class="k">then</span>
        <span class="nv">list</span><span class="o">=</span>acc-<span class="nv">$nc</span>-<span class="nv">$nf</span>
    <span class="k">else</span>
        <span class="nv">list</span><span class="o">=</span><span class="nv">$list</span>,acc-<span class="nv">$nc</span>-<span class="nv">$nf</span>
    <span class="k">fi</span>
  <span class="k">done</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="nv">$list</span>
</code></pre></div>
<h2 id="timestamp">timestamp<a class="headerlink" href="#timestamp" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nv">timestamp</span><span class="o">=</span><span class="k">$(</span>date +<span class="s2">&quot;%Y-%m-%dT%H:%M:%S&quot;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$timestamp</span>
<span class="c1"># 2020-02-11T10:51:42</span>
</code></pre></div>
<h3 id="compare-two-timestamps">compare two timestamps<a class="headerlink" href="#compare-two-timestamps" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">d1</span><span class="o">=</span><span class="k">$(</span>date -d <span class="s2">&quot;2019-09-22 20:07:25&quot;</span> +<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="nv">d2</span><span class="o">=</span><span class="k">$(</span>date -d <span class="s2">&quot;2019-09-22 20:08:25&quot;</span> +<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$d1</span> -gt <span class="nv">$d2</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;d1 &gt; d2&quot;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;d1 &lt; d2&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p>where</p>
<ul>
<li><code>-d</code>: display time described by STRING, not &lsquo;now&rsquo; (from <code>man date</code>)</li>
<li><code>+%[format-option]</code>: format specifiers (details formats refer to <code>man date</code>, but I am curious why <code>+</code>, no hints from <code>many date</code>, but here is one from <a href="https://www.geeksforgeeks.org/date-command-linux-examples/">date command in Linux with examples</a>)</li>
<li><code>-gt</code>: larger than, <code>-lt</code>: less than; with equality, <code>-ge</code> and <code>-le</code>, (from <a href="https://www.runoob.com/linux/linux-shell-basic-operators.html">Shell 基本运算符</a>)</li>
<li>条件表达式要放在方括号之间，并且要有空格, from <a href="https://www.runoob.com/linux/linux-shell-basic-operators.html">Shell 基本运算符</a></li>
</ul>
<p>refer to <a href="https://unix.stackexchange.com/questions/375911/how-to-compare-two-time-stamps">How to compare two time stamps?</a></p>
<h2 id="globbing-for-ls-vs-regular-expression-for-find">globbing for <code>ls</code> vs regular expression for <code>find</code><a class="headerlink" href="#globbing-for-ls-vs-regular-expression-for-find" title="Permanent link">&para;</a></h2>
<p>Support we want to get <code>abc2.txt</code> as stated in <a href="https://unix.stackexchange.com/questions/44754/listing-with-ls-and-regular-expression">Listing with <code>ls</code> and regular expression
</a>,</p>
<p><code>ls</code> does not support regular expressions, but it can work with globbing, or filename expressions.</p>
<div class="highlight"><pre><span></span><code>ls *<span class="o">[</span>!0-9<span class="o">][</span><span class="m">0</span>-9<span class="o">]</span>.txt
</code></pre></div>
<p>where <code>!</code> is complement.</p>
<p>Alternatively, we can use <code>find -regex</code>,</p>
<div class="highlight"><pre><span></span><code>find . -maxdepth <span class="m">1</span> -regex <span class="s1">&#39;\./.*[^0-9][0-9]\.txt&#39;</span>
</code></pre></div>
<p>where</p>
<ul>
<li><code>-maxdepth 1</code> disables recursive, and only to find files in the current directory</li>
</ul>
<p>We also can add <code>-exec ls</code> to get the output of <code>ls</code>, and change the regex type by <code>-regextype egrep</code>.</p>
<h2 id="select-the-first-field">select the first field<a class="headerlink" href="#select-the-first-field" title="Permanent link">&para;</a></h2>
<p>given filename <code>file.txt</code>, want to get a string <code>file_test</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="o">=</span><span class="k">$(</span>cut -d<span class="s1">&#39;.&#39;</span> -f1 <span class="o">&lt;&lt;&lt;</span> <span class="nv">$1</span><span class="k">)</span>_test
<span class="nb">echo</span> <span class="nv">$a</span>
</code></pre></div>
<p>where <code>-d'.'</code> is to define the delimiter, and then <code>-f1</code> get the first field.</p>
<p>If we need to get the last field, we can use <code>rev</code>, i.e.,</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s1">&#39;maps.google.com&#39;</span> <span class="p">|</span> rev <span class="p">|</span> cut -d<span class="s1">&#39;.&#39;</span> -f <span class="m">1</span> <span class="p">|</span> rev
</code></pre></div>
<p>refer to <a href="https://stackoverflow.com/questions/22727107/how-to-find-the-last-field-using-cut">How to find the last field using &lsquo;cut&rsquo;</a></p>
<h2 id="multiple-ifs">Multiple <code>IFS</code><a class="headerlink" href="#multiple-ifs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -a ADDR<span class="p">;</span> <span class="k">do</span>
        <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;:&#39;</span> <span class="nb">read</span> -a Line <span class="o">&lt;&lt;&lt;</span> <span class="nv">$ADDR</span>
        <span class="nb">echo</span> <span class="si">${</span><span class="nv">Line</span><span class="p">[0]</span><span class="si">}</span><span class="p">;</span>
<span class="k">done</span> &lt; &lt;<span class="o">(</span>grep -nE <span class="s2">&quot;finished&quot;</span> slurm-37985.out<span class="o">)</span>
</code></pre></div>
<p>will also output the numbers of the finished line.</p>
<ul>
<li><code>&lt;()</code> is called <a href="https://superuser.com/questions/1059781/what-exactly-is-in-bash-and-in-zsh">process substitution</a></li>
<li><code>&lt;&lt;&lt;</code> is known as <code>here string</code>, and <a href="https://askubuntu.com/questions/678915/whats-the-difference-between-and-in-bash">different from <code>&lt;&lt;</code>, <code>&lt;</code></a></li>
</ul>
<p>refer to <a href="https://stackoverflow.com/questions/23356779/how-can-i-store-the-find-command-results-as-an-array-in-bash">How can I store the “find” command results as an array in Bash</a></p>
<p>my working case:</p>
<div class="highlight"><pre><span></span><code><span class="nv">files</span><span class="o">=()</span>
<span class="nv">start_time</span><span class="o">=</span><span class="k">$(</span>date -d <span class="s2">&quot;2019-09-21T14:11:16&quot;</span> +<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="nv">end_time</span><span class="o">=</span><span class="k">$(</span>date -d <span class="s2">&quot;2019-09-22T20:07:00&quot;</span> +<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span>  <span class="nb">read</span> -r -d <span class="s1">$&#39;\0&#39;</span><span class="p">;</span> <span class="k">do</span>
  <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;_&#39;</span> <span class="nb">read</span> -ra ADDR <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;</span><span class="nv">$REPLY</span><span class="s2">&quot;</span>
  <span class="nv">timestamp</span><span class="o">=</span><span class="k">$(</span>date -d <span class="si">${</span><span class="nv">ADDR</span><span class="p">[2]</span><span class="si">}</span> +<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$timestamp</span> -ge <span class="nv">$start_time</span> -a <span class="nv">$timestamp</span> -lt <span class="nv">$end_time</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">curr_folder</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[2]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nv">files</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[2]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
    qsub -v <span class="nv">folder</span><span class="o">=</span><span class="si">${</span><span class="nv">curr_folder</span><span class="si">}</span> revisit_sil_parallel.job
  <span class="k">fi</span>
<span class="k">done</span> &lt; &lt;<span class="o">(</span>find . -maxdepth <span class="m">1</span> -regex <span class="s2">&quot;\./oracle_setting_2019-09-.*recall\.pdf&quot;</span> -print0<span class="o">)</span>
</code></pre></div>
<h2 id="_4">链接自动推送<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>find -regex <span class="s2">&quot;\./.*\.html&quot;</span> <span class="p">|</span> sed -n <span class="s2">&quot;s#\./#https://esl.hohoweiya.xyz/#p&quot;</span> &gt;&gt; ../urls.txt
</code></pre></div>
<h2 id="only-show-directory">Only show directory<a class="headerlink" href="#only-show-directory" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>ls -d */
</code></pre></div>
<p>refer to <a href="https://stackoverflow.com/questions/14352290/listing-only-directories-using-ls-in-bash">Listing only directories using ls in Bash?</a></p>
<p>My application: <a href="https://github.com/szcf-weiya/TeXtemplates/blob/master/new.sh#L9">TeXtemplates: create a tex template</a></p>
<h2 id="check-whether-a-certain-file-typeextension-exists-in-directory">Check whether a certain file type/extension exists in directory<a class="headerlink" href="#check-whether-a-certain-file-typeextension-exists-in-directory" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">if</span> ls *.bib <span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span> <span class="k">then</span>
  <span class="c1">#</span>
<span class="k">fi</span>
</code></pre></div>
<p>refer to <a href="https://stackoverflow.com/questions/3856747/check-whether-a-certain-file-type-extension-exists-in-directory">Check whether a certain file type/extension exists in directory</a></p>
<p>My application: <a href="https://github.com/szcf-weiya/TeXtemplates/blob/master/new.sh#L18-L20">TeXtemplates: create a tex template</a></p>
<h2 id="get-path-of-the-current-script">Get path of the current script<a class="headerlink" href="#get-path-of-the-current-script" title="Permanent link">&para;</a></h2>
<p>we can get the path of the current script via</p>
<div class="highlight"><pre><span></span><code><span class="nv">CURDIR</span><span class="o">=</span><span class="sb">`</span>/bin/pwd<span class="sb">`</span>
<span class="nv">BASEDIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="nv">$0</span><span class="k">)</span>
<span class="nv">ABSPATH</span><span class="o">=</span><span class="k">$(</span>readlink -f <span class="nv">$0</span><span class="k">)</span>
<span class="nv">ABSDIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="nv">$ABSPATH</span><span class="k">)</span>
</code></pre></div>
<p>refer to <a href="https://gist.github.com/darrenderidder/974638">darrenderidder/bashpath.sh</a></p>
<p>where <code>dirname</code>, together with <code>basename</code> aims to extract the filename and path, such as</p>
<div class="highlight"><pre><span></span><code>$ basename /dir1/dir2/file.txt
file.txt
$ dirname /dir1/dir2/file.txt
/dir1/dir2
$ dirname <span class="sb">`</span>dirname /dir1/dir2/file.txt<span class="sb">`</span>
/dir1
</code></pre></div>
<p>but note that <code>dirname</code> would also return the parent directory of a directory, as shown in the last case.</p>
<p>Alternatively, we can use <code>${}</code> to extract the path,</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 从左开始最大化匹配到字符 `/`，然后截掉左边内容（包括`/`)</span>
$ <span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.txt <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">##*/</span><span class="si">}</span>
file.txt
<span class="c1"># 文件后缀</span>
$ <span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.txt <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">##*.</span><span class="si">}</span>
txt
<span class="c1"># 两个文件后缀（从左开始第一次匹配到字符 `.`，然后截掉左边内容（包括`/`)</span>
$ <span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.tar.gz <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">#*.</span><span class="si">}</span>
tar.gz
<span class="c1"># 从右开始第一次匹配到字符 `/`</span>
$ <span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.txt <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">%/*</span><span class="si">}</span>
/dir1/dir2
<span class="c1"># 从右最大化匹配到字符 `.`</span>
$ <span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.tar.gz <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">%%.*</span><span class="si">}</span>
/dir1/dir2/file
</code></pre></div>
<p>其中 <code>*</code> 表示要删除的内容，另外还需要一个字符表示截断点，注意到与 <code>#</code> 使用时截断字符在右边，而与 <code>%</code> 使用时截断字符在左边。</p>
<p>参考 <a href="http://blog.csdn.net/universe_hao/article/details/52640321">shell 提取文件名和目录名</a></p>
<h2 id="if-statement"><code>if</code> statement<a class="headerlink" href="#if-statement" title="Permanent link">&para;</a></h2>
<p>We can add <code>&amp;&gt; /dev/null</code> to hidden the output information in the condition of <code>if</code>. For example, check if user exists,</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># refer to https://blog.51cto.com/64314491/1629175</span>
<span class="k">if</span> id <span class="nv">$1</span> <span class="p">&amp;</span>&gt; /dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2"> exists&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2"> is not exists&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<h3 id="logical-operation">logical operation<a class="headerlink" href="#logical-operation" title="Permanent link">&para;</a></h3>
<p>判断 Linux 发行版所属主流发行系列，另见 <a href="../Linux/#linux-distributions">Linux Distributions</a></p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">==</span> Fedora -o <span class="nv">$1</span> <span class="o">==</span> Gentoo -o <span class="nv">$1</span> <span class="o">==</span> Redhat <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Redhat Series.&quot;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">==</span> Suse -o <span class="nv">$1</span> <span class="o">==</span> Opensuse <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Suse Series.&quot;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">==</span> Ubuntu -o <span class="nv">$1</span> <span class="o">==</span> Mint -o <span class="nv">$1</span> <span class="o">==</span> Debian <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Debian Series.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Unknown Series.&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<h3 id="test-string">test string<a class="headerlink" href="#test-string" title="Permanent link">&para;</a></h3>
<ul>
<li><code>=~</code>: 判断左边的字符串是否能被右边的模式所匹配</li>
<li><code>-z $A</code>: 为空则为真，否则为假</li>
<li><code>-n $A</code>: 为空则为假，否则为真</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">Shell</span><span class="o">=</span><span class="sb">`</span>grep <span class="s2">&quot;^</span><span class="nv">$1</span><span class="s2">:&quot;</span> /etc/passwd <span class="p">|</span> cut -d: -f7<span class="sb">`</span>
<span class="k">if</span> <span class="o">[[</span> -z <span class="nv">$Shell</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;No such user&quot;</span>
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$Shell</span> <span class="o">=</span>~ sh$ <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Login user&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Not a login user&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<h3 id="test-file">test file<a class="headerlink" href="#test-file" title="Permanent link">&para;</a></h3>
<p>格式为 <code>[ EXPR FILE ]</code>，其中常见 <code>EXPR</code> 有</p>
<ul>
<li><code>-f</code>: 测试其是否为普通文件，即 <code>ls -l</code> 时文件类型为 <code>-</code> 的文件</li>
<li><code>-d</code>: 测试其是否为目录文件，即 <code>ls -l</code> 时文件类型为 <code>d</code> 的文件</li>
<li><code>-e</code>: 测试文件是否存在；存在为真，否则为假</li>
<li><code>-r</code>: 测试文件对当前用户来说是否可读</li>
<li><code>-w</code>: 测试文件对当前用户来说是否可写</li>
<li><code>-x</code>: 测试文件对当前用户来说是否可执行</li>
<li><code>-s</code>: 测试文件大小是否不空，不空则真，空则假</li>
</ul>
<p>例子</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="o">[</span> ! -e /tmp/test <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  mkdir /tmp/test
<span class="k">fi</span>
</code></pre></div>
<p>refer to <a href="https://blog.51cto.com/64314491/1629175">bash条件判断之if语句</a></p>
<h2 id="aka-test-vs"><code>[</code> (aka <code>test</code>) vs <code>[[</code><a class="headerlink" href="#aka-test-vs" title="Permanent link">&para;</a></h2>
<p>Refer to [What is the difference between test, [ and [<a href="http://mywiki.wooledge.org/BashFAQ/031"> ?</a></p>
<p>Both are used to evaluate expressions, but</p>
<ul>
<li><code>[[</code> works only in Korn shell, Bash, Zsh, and recent versions of Yash and busybox <code>sh</code></li>
<li><code>[</code> is POSIX utilities (generally builtin)</li>
</ul>
<p><img alt="" src="test.png" /></p>
<p>But there are some differences:</p>
<ul>
<li>no word splitting or glob expansion will be done for <code>[[</code>, i.e., many arguments need not be quoted, while <code>[</code> usually should be quoted</li>
<li>parentheses in <code>[[</code> do not need to be escaped</li>
</ul>
<p>also see</p>
<ul>
<li><a href="https://unix.stackexchange.com/questions/99185/what-do-square-brackets-mean-without-the-if-on-the-left">What do square brackets mean without the “if” on the left?</a></li>
<li><a href="https://stackoverflow.com/questions/669452/is-double-square-brackets-preferable-over-single-square-brackets-in-ba">Is double square brackets preferable over single square brackets in Bash?</a></li>
</ul>
<h3 id="_5"><code>$[</code><a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>Refer to <a href="https://unix.stackexchange.com/questions/209833/what-does-a-dollar-sign-followed-by-a-square-bracket-mean-in-bash">What does a dollar sign followed by a square bracket mean in bash?</a></p>
<p>With <code>$</code>, <code>[</code> is also can be used for arithmetic expansion, such as</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> $<span class="o">[</span> <span class="nv">$RANDOM</span> % <span class="m">2</span> <span class="o">]</span>
<span class="m">0</span> <span class="c1"># 1</span>
$ <span class="nb">echo</span> $<span class="o">[</span> <span class="m">1</span>+2 <span class="o">]</span>
<span class="m">3</span>
</code></pre></div>
<p>and actually <code>$[</code> syntax is an early syntax that was deprecated in favor of <code>$((</code>, although it&rsquo;s not completely removed yet.</p>
<h3 id="vs-vs-eq"><code>=</code> vs <code>==</code> vs <code>-eq</code><a class="headerlink" href="#vs-vs-eq" title="Permanent link">&para;</a></h3>
<p>from the above discussion:</p>
<ul>
<li><code>==</code> is a bash-ism</li>
<li><code>=</code> is POSIX</li>
</ul>
<p>In bash the two are equivalent, but in plain sh <code>=</code> is the only one guaranteed to work. And these two are for string comparisons, while <code>-eq</code> is for numerical ones.</p>
<p>refer to <a href="https://stackoverflow.com/questions/20449543/shell-equality-operators-eq">Shell equality operators (=, ==, -eq)</a></p>
<h2 id="compare-string">compare string<a class="headerlink" href="#compare-string" title="Permanent link">&para;</a></h2>
<h2 id="grep-keep-the-first-line-use-sed-instead">grep keep the first line (use <code>sed</code> instead)<a class="headerlink" href="#grep-keep-the-first-line-use-sed-instead" title="Permanent link">&para;</a></h2>
<p>Refer to <a href="https://stackoverflow.com/questions/12920317/include-header-in-the-grep-result">Include header in the &lsquo;grep&rsquo; result</a></p>
<p>I am using</p>
<div class="highlight"><pre><span></span><code>$ sinfo -o <span class="s2">&quot;%P %N %C %G&quot;</span> -N <span class="p">|</span> grep gpu
</code></pre></div>
<p>to get the GPU status of the nodes on the cluster, but the header cannot be kept, then I tried</p>
<div class="highlight"><pre><span></span><code>$ sinfo -o <span class="s2">&quot;%P %N %C %G&quot;</span> -N <span class="p">|</span> <span class="o">{</span> head -1<span class="p">;</span> grep gpu<span class="p">;</span> <span class="o">}</span>
</code></pre></div>
<p>but it only shows the header</p>
<p>Next I got the excellent solution via <code>sed</code>,</p>
<div class="highlight"><pre><span></span><code>$ sinfo -o <span class="s2">&quot;%P %N %C %G&quot;</span> -N <span class="p">|</span> sed -n <span class="s2">&quot;1p;/gpu/p&quot;</span>
</code></pre></div>
<p>and it can hide the highlighter of <code>gpu</code>.</p>
<h2 id="compare-two-blocks-in-a-txt-file">compare two blocks in a txt file<a class="headerlink" href="#compare-two-blocks-in-a-txt-file" title="Permanent link">&para;</a></h2>
<p>for example, compare L82-95 with L108-123,</p>
<div class="highlight"><pre><span></span><code>$ diff &lt;<span class="o">(</span>sed -n <span class="s2">&quot;82,95p&quot;</span> measure.jl<span class="o">)</span> &lt;<span class="o">(</span>sed -n <span class="s2">&quot;108,123p&quot;</span> measure.jl<span class="o">)</span>
</code></pre></div>
<h2 id="_6"><code>||</code><a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>No <code>try...catch</code> in bash script, but <code>command1 || command2</code> can achieve similar functionality, if <code>command1</code> fails then <code>command2</code> runs.</p>
<p>An application is to create a new tmux session if there is no such a tmux session,</p>
<div class="highlight"><pre><span></span><code>t<span class="o">()</span> <span class="o">{</span> tmux a -t <span class="nv">$1</span> <span class="o">||</span> tmux new -s <span class="nv">$1</span><span class="p">;</span> <span class="o">}</span>
</code></pre></div>
<p>refer to <a href="https://stackoverflow.com/questions/22009364/is-there-a-try-catch-command-in-bash">Is there a TRY CATCH command in Bash</a></p>
<h2 id="replace-a-multiple-line-string">Replace a multiple line string<a class="headerlink" href="#replace-a-multiple-line-string" title="Permanent link">&para;</a></h2>
<!--
![](https://img.shields.io/badge/-sed-brightgreen) ![](https://img.shields.io/badge/-perl-orange)
-->

<p><code>sed</code> is powerful for replace in one-line, but it would be much more complicated for multiple line string. </p>
<p>An alternative is to use <code>perl</code>,</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">printf</span> <span class="s2">&quot;###BEGIN-EXCLUDE\nwww\n###END-EXCLUDE&quot;</span> <span class="p">|</span> perl -0777 -pe <span class="s2">&quot;s/###BEGIN-EXCLUDE(.*?)###END-EXCLUDE/xxx/igs&quot;</span>
xxx
</code></pre></div>
<p>where</p>
<ul>
<li><code>-0777</code> causes Perl to slurp files whole, see <a href="https://perldoc.perl.org/perlrun">-0[octal/hexadecimal]</a> for more details</li>
<li><code>-e commandline</code></li>
<li><code>-p</code>: my understanding is something for printing, but the <a href="https://perldoc.perl.org/perlrun">official document</a> explain more </li>
</ul>
<p>For a file to be edited in-place, we add <code>-i</code>,</p>
<div class="highlight"><pre><span></span><code>$ perl -0777 -i -pe <span class="s2">&quot;s/###BEGIN-EXCLUDE(.*?)###END-EXCLUDE//igs&quot;</span> test.txt
</code></pre></div>
<p>if we supply an extension such as <code>-i'.orig'</code>, then the old file would be backed up to <code>test.txt.orig</code>.</p>
<p>Refer to <a href="https://unix.stackexchange.com/questions/26284/how-can-i-use-sed-to-replace-a-multi-line-string">How can I use sed to replace a multi-line string?</a></p>
<p>Moreover, <code>.*?</code> is a non-greedy match, comparing to <code>.*</code>. </p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">echo</span> <span class="s2">&quot;s12tAs34t&quot;</span> <span class="p">|</span> perl -pe <span class="s2">&quot;s/s(.*?)t/xx/igs&quot;</span>
xxAxx
$ <span class="nb">echo</span> <span class="s2">&quot;s12tAs34t&quot;</span> <span class="p">|</span> perl -pe <span class="s2">&quot;s/s(.*)t/xx/igs&quot;</span>
xx
</code></pre></div>
<p>Refer to <a href="https://docstore.mik.ua/orelly/perl/cookbook/ch06_16.htm">6.15. Greedy and Non-Greedy Matches docstore.mik.ua/orelly/perl/cookbook/ch06_16.htm</a> for details.</p>
<p>By default, <code>grep</code> performs greedy match, adding option <code>-P</code> would enable Perl&rsquo;s non-greedy match.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/13688320/119338519-adc55480-bcc2-11eb-9fac-bb32d2b9c72d.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>An real application: <a href="https://github.com/szcf-weiya/Cell-Video/blob/67fef1b7737e97631aa9568b000a8c61ef1590f4/report/update_bib.sh#L21">update_bib.sh</a></p>
</div>
<p>Refer to <a href="https://stackoverflow.com/questions/3027518/how-to-do-a-non-greedy-match-in-grep/3027524">How to do a non-greedy match in grep?</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../Linux/asAserver/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              笔记本作为服务器
            </div>
          </div>
        </a>
      
      
        <a href="../R/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              一般问题
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017-2021 weiya
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/szcf-weiya" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://esl.hohoweiya.xyz" target="_blank" rel="noopener" title="esl.hohoweiya.xyz" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hohoweiya.xyz" target="_blank" rel="noopener" title="hohoweiya.xyz" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26 96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47 488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://stats.hohoweiya.xyz" target="_blank" rel="noopener" title="stats.hohoweiya.xyz" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M552 64H112c-20.858 0-38.643 13.377-45.248 32H24c-13.255 0-24 10.745-24 24v272c0 30.928 25.072 56 56 56h496c13.255 0 24-10.745 24-24V88c0-13.255-10.745-24-24-24zM48 392V144h16v248c0 4.411-3.589 8-8 8s-8-3.589-8-8zm480 8H111.422c.374-2.614.578-5.283.578-8V112h416v288zM172 280h136c6.627 0 12-5.373 12-12v-96c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v96c0 6.627 5.373 12 12 12zm28-80h80v40h-80v-40zm-40 140v-24c0-6.627 5.373-12 12-12h136c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12H172c-6.627 0-12-5.373-12-12zm192 0v-24c0-6.627 5.373-12 12-12h104c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12H364c-6.627 0-12-5.373-12-12zm0-144v-24c0-6.627 5.373-12 12-12h104c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12H364c-6.627 0-12-5.373-12-12zm0 72v-24c0-6.627 5.373-12 12-12h104c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12H364c-6.627 0-12-5.373-12-12z"/></svg>
      </a>
    
      
      
      <a href="mailto:szcfweiya@gmail.com" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.a1609d9a.min.js"></script>
      
        <script src="../javascripts/baiduzhanzhang.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>